<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Race Timer App</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .hidden {
        display: none;
      }
      #timer-display {
        font-size: 1.5rem;
        font-weight: bold;
      }
      .disabled-button {
        pointer-events: none;
        opacity: 0.6;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <div class="text-center">
        <h1>Race Timer</h1>
        <p class="text-muted">Manage your race rounds easily!</p>
      </div>
      <!-- Add Runners Section -->
      <div class="text-center mt-4">
        <button id="add-runner-button" class="btn btn-secondary">
          Add Runner
        </button>
      </div>

      <!-- Runner List -->
      <div id="runners-list" class="mt-4">
        <h4>Runners:</h4>
        <ul id="runners" class="list-group"></ul>
      </div>

      <!-- Runner Details Section -->
      <div id="runner-details" class="hidden mt-4">
        <h5 id="runner-name"></h5>
        <!-- Timer Input -->
        <div class="text-center">
          <label for="race-timer" class="form-label"
            >Race Time (minutes):</label
          >
          <input
            id="race-timer"
            type="number"
            class="form-control d-inline-block w-25"
            placeholder="Enter minutes"
          />
        </div>
        <!-- Timer and Controls -->
        <div class="text-center mt-3">
          <button id="start-timer-button" class="btn btn-warning">
            Start Timer
          </button>
          <div id="timer-display" class="mt-3 text-danger"></div>
          <div class="progress mt-3" style="height: 20px">
            <div
              id="timer-progress"
              class="progress-bar"
              role="progressbar"
              style="width: 0%"
              aria-valuenow="0"
              aria-valuemin="0"
              aria-valuemax="100"
            ></div>
          </div>
        </div>
        <!-- Round Controls -->
        <div class="mt-3 text-center">
          <button id="plus-button" class="btn btn-success disabled-button">
            +
          </button>
          <button id="minus-button" class="btn btn-danger disabled-button">
            -
          </button>
        </div>
        <!-- Rounds List -->
        <div id="rounds-list" class="mt-4">
          <h4>Rounds:</h4>
          <ul id="rounds" class="list-group"></ul>
        </div>
      </div>

      <!-- Start Race Section -->
      <div id="start-race-section" class="text-center mt-4">
        <button id="start-race-button" class="btn btn-primary btn-lg">
          Start Race
        </button>
      </div>
      <!-- Race Timer & Rounds Section -->
      <div id="race-section" class="hidden mt-4">
        <!-- Timer Input -->
        <div class="text-center">
          <label for="race-timer" class="form-label"
            >Race Time (minutes):</label
          >
          <input
            id="race-timer"
            type="number"
            class="form-control d-inline-block w-25"
            placeholder="Enter minutes"
          />
        </div>
        <!-- Timer and Controls -->
        <div class="text-center mt-3">
          <button id="start-timer-button" class="btn btn-warning">
            Start Timer
          </button>
          <div id="timer-display" class="mt-3 text-danger"></div>
        </div>
        <!-- Round Controls -->
        <div class="mt-3 text-center">
          <button id="plus-button" class="btn btn-success disabled-button">
            +
          </button>
          <button id="minus-button" class="btn btn-danger disabled-button">
            -
          </button>
        </div>
        <!-- Rounds List -->
        <div id="rounds-list" class="mt-4">
          <h4>Rounds:</h4>
          <ul id="rounds" class="list-group"></ul>
        </div>
      </div>
    </div>
    <script>
      const addRunnerButton = document.getElementById("add-runner-button");
      const runnersList = document.getElementById("runners");
      const runnerDetailsSection = document.getElementById("runner-details");
      const runnerNameDisplay = document.getElementById("runner-name");
      const startTimerButton = document.getElementById("start-timer-button");
      const raceTimerInput = document.getElementById("race-timer");
      const timerDisplay = document.getElementById("timer-display");
      const timerProgressBar = document.getElementById("timer-progress");
      const plusButton = document.getElementById("plus-button");
      const minusButton = document.getElementById("minus-button");
      const roundsList = document.getElementById("rounds");

      let runners = [];
      let currentRunnerIndex = -1;
      let roundCounter = 0;
      let timerInterval;
      let timeLeft;
      let totalTime;

      addRunnerButton.addEventListener("click", () => {
        const runnerName = prompt("Enter Runner Name:");
        if (runnerName) {
          // Create a new runner
          const runner = {
            name: runnerName,
            rounds: [],
            timer: {
              timeLeft: 0,
              totalTime: 0,
              interval: null,
            },
          };
          runners.push(runner);

          // Add to the runners list UI
          const runnerItem = document.createElement("li");
          runnerItem.classList.add("list-group-item");
          runnerItem.textContent = runnerName;
          runnerItem.addEventListener("click", () => loadRunner(runnerName));
          runnersList.appendChild(runnerItem);
        }
      });

      function loadRunner(runnerName) {
        // Find the selected runner by name
        const runner = runners.find((r) => r.name === runnerName);
        currentRunnerIndex = runners.indexOf(runner);

        // Display the runner details
        runnerNameDisplay.textContent = `Runner: ${runnerName}`;
        raceTimerInput.value = "";
        timerDisplay.textContent = "";
        roundsList.innerHTML = "";
        timeLeft = 0;
        totalTime = 0;
        roundCounter = 0;

        // Reset timer progress
        timerProgressBar.style.width = "0%";
        plusButton.classList.add("disabled-button");
        minusButton.classList.add("disabled-button");

        runnerDetailsSection.classList.remove("hidden");
      }

      // Add a new round with its timestamp for the current runner
      plusButton.addEventListener("click", () => {
        if (timeLeft > 0) {
          roundCounter++;
          const roundTime =
            Math.floor(timeLeft / 60) +
            ":" +
            (timeLeft % 60).toString().padStart(2, "0");
          const roundItem = document.createElement("li");
          roundItem.classList.add("list-group-item");
          roundItem.textContent = `Round ${roundCounter} - Time Remaining: ${roundTime}`;
          roundsList.appendChild(roundItem);

          // Save the round to the current runner
          runners[currentRunnerIndex].rounds.push(roundTime);
        }
      });

      // Remove the last round for the current runner
      minusButton.addEventListener("click", () => {
        if (roundCounter > 0) {
          const lastRound = roundsList.lastElementChild;
          lastRound.remove();
          roundCounter--;

          // Remove the round from the current runner's rounds
          runners[currentRunnerIndex].rounds.pop();
        }
      });

      // Start the timer for the current runner
      startTimerButton.addEventListener("click", () => {
        const raceTime = parseInt(raceTimerInput.value);
        if (isNaN(raceTime) || raceTime <= 0) {
          alert("Please enter a valid race time (in minutes).");
          return;
        }

        // Enable the add and delete buttons during the race
        plusButton.classList.remove("disabled-button");
        minusButton.classList.remove("disabled-button");

        // Set the timer for the current runner
        timeLeft = raceTime * 60;
        totalTime = timeLeft; // Save the total time for progress calculation

        // Clear any existing timer
        if (runners[currentRunnerIndex].timer.interval) {
          clearInterval(runners[currentRunnerIndex].timer.interval);
        }

        // Start countdown
        runners[currentRunnerIndex].timer.interval = setInterval(() => {
          const minutes = Math.floor(timeLeft / 60);
          const seconds = timeLeft % 60;

          // Update timer display
          timerDisplay.textContent = `Time Left: ${minutes}:${
            seconds < 10 ? "0" : ""
          }${seconds}`;

          // Update progress bar
          const progress = ((totalTime - timeLeft) / totalTime) * 100;
          timerProgressBar.style.width = `${progress}%`;

          // Check if time is up
          if (timeLeft <= 0) {
            clearInterval(runners[currentRunnerIndex].timer.interval);
            timerDisplay.textContent = "Race Over!";
            plusButton.classList.add("disabled-button");
            minusButton.classList.add("disabled-button");
            timerProgressBar.style.width = "100%";
          }

          timeLeft--;
        }, 1000);
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
